<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- CSS -->
<title>timerpool</title>
<link rel="stylesheet" type="text/css" href="nimdoc.out.css">

<script type="text/javascript" src="dochack.js"></script>

<script type="text/javascript">
function main() {
  var pragmaDots = document.getElementsByClassName("pragmadots");
  for (var i = 0; i < pragmaDots.length; i++) {
    pragmaDots[i].onclick = function(event) {
      // Hide tease
      event.target.parentNode.style.display = "none";
      // Show actual
      event.target.parentNode.nextElementSibling.style.display = "inline";
    }
  }

  const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
  function switchTheme(e) {
      if (e.target.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
      } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
      }
  }

  toggleSwitch.addEventListener('change', switchTheme, false);


  if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    document.documentElement.setAttribute('data-theme', "dark");
    toggleSwitch.checked = true;
  } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
    document.documentElement.setAttribute('data-theme', "light");
    toggleSwitch.checked = false;
  } else {
    const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
    if (currentTheme) {
      document.documentElement.setAttribute('data-theme', currentTheme);

      if (currentTheme === 'dark') {
        toggleSwitch.checked = true;
      }
    }
  }
}
</script>

</head>
<body onload="main()">
<div class="document" id="documentId">
  <div class="container">
    <h1 class="title">timerpool</h1>
    <div class="row">
  <div class="three columns">
  <div class="theme-switch-wrapper">
    <label class="theme-switch" for="checkbox">
      <input type="checkbox" id="checkbox" />
      <div class="slider round"></div>
    </label>
    &nbsp;&nbsp;&nbsp; <em>Dark Mode</em>
  </div>
  <div id="global-links">
    <ul class="simple">
    </ul>
  </div>
  <div id="searchInputDiv">
    Search: <input type="text" id="searchInput"
      onkeyup="search()" />
  </div>
  <div>
    Group by:
    <select onchange="groupBy(this.value)">
      <option value="section">Section</option>
      <option value="type">Type</option>
    </select>
  </div>
  <ul class="simple simple-toc" id="toc-list">
<li>
  <a class="reference reference-toplevel" href="#7" id="57">Types</a>
  <ul class="simple simple-toc-section">
      <li><a class="reference" href="#TimerHandlePtr"
    title="TimerHandlePtr = ptr TimerHandle"><wbr />Timer<wbr />Handle<wbr />Ptr<span class="attachedType"></span></a></li>
  <li><a class="reference" href="#TPError"
    title="TPError = object of Exception"><wbr />TPError<span class="attachedType"></span></a></li>
  <li><a class="reference" href="#TimerPoolPtr"
    title="TimerPoolPtr = ptr TimerPool"><wbr />Timer<wbr />Pool<wbr />Ptr<span class="attachedType"></span></a></li>
  <li><a class="reference" href="#TimerPoolRef"
    title="TimerPoolRef = ref TimerPool"><wbr />Timer<wbr />Pool<wbr />Ref<span class="attachedType"></span></a></li>
  <li><a class="reference" href="#Tickval"
    title="Tickval = range[1 .. int.high]"><wbr />Tickval<span class="attachedType"></span></a></li>
  <li><a class="reference" href="#MinTimerval"
    title="MinTimerval = range[1 .. int.high]"><wbr />Min<wbr />Timerval<span class="attachedType"></span></a></li>
  <li><a class="reference" href="#PoolStats"
    title="PoolStats = tuple[runningCount: int, freedCount: int, inactiveCount: int]"><wbr />Pool<wbr />Stats<span class="attachedType"></span></a></li>

  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#12" id="62">Procs</a>
  <ul class="simple simple-toc-section">
      <li><a class="reference" href="#initThreadContext%2CTimerPoolPtr"
    title="initThreadContext(tpptr: TimerPoolPtr): void"><wbr />init<wbr />Thread<wbr />Context<span class="attachedType">TimerPoolPtr</span></a></li>
  <li><a class="reference" href="#newTimerPool%2CTickval%2CMinTimerval"
    title="newTimerPool(tbase_ms: Tickval = 100; minFreedTimers: MinTimerval = 5): ref TimerPool"><wbr />new<wbr />Timer<wbr />Pool<span class="attachedType">Tickval</span></a></li>
  <li><a class="reference" href="#deinitThreadContext%2CTimerPoolPtr"
    title="deinitThreadContext(tpptr: TimerPoolPtr): void"><wbr />deinit<wbr />Thread<wbr />Context<span class="attachedType">TimerPoolPtr</span></a></li>
  <li><a class="reference" href="#allocTimer%2CTimerPoolPtr"
    title="allocTimer(tpptr: TimerPoolPtr): TimerHandlePtr"><wbr />alloc<wbr />Timer<span class="attachedType">TimerPoolPtr</span></a></li>
  <li><a class="reference" href="#allocTimer%2CTimerPoolRef"
    title="allocTimer(tpptr: TimerPoolRef): TimerHandlePtr"><wbr />alloc<wbr />Timer<span class="attachedType">TimerPoolRef</span></a></li>
  <li><a class="reference" href="#deallocTimer%2CTimerHandlePtr"
    title="deallocTimer(timerhdl: TimerHandlePtr): void"><wbr />dealloc<wbr />Timer<span class="attachedType">TimerHandlePtr</span></a></li>
  <li><a class="reference" href="#setAlarmCounter%2CTimerHandlePtr%2CTickval"
    title="setAlarmCounter(timerhdl: TimerHandlePtr; value: Tickval): void"><wbr />set<wbr />Alarm<wbr />Counter<span class="attachedType">TimerHandlePtr</span></a></li>
  <li><a class="reference" href="#getAlarmCounter%2CTimerHandlePtr"
    title="getAlarmCounter(timerhdl: TimerHandlePtr): int"><wbr />get<wbr />Alarm<wbr />Counter<span class="attachedType">TimerHandlePtr</span></a></li>
  <li><a class="reference" href="#waitForAlarm%2CTimerHandlePtr"
    title="waitForAlarm(timerhdl: TimerHandlePtr): void"><wbr />wait<wbr />For<wbr />Alarm<span class="attachedType">TimerHandlePtr</span></a></li>
  <li><a class="reference" href="#waitForGetStats%2CTimerPoolPtr"
    title="waitForGetStats(tpptr: TimerPoolPtr): PoolStats"><wbr />wait<wbr />For<wbr />Get<wbr />Stats<span class="attachedType">TimerPoolPtr</span></a></li>
  <li><a class="reference" href="#shrinkTimerPool%2CTimerPoolPtr"
    title="shrinkTimerPool(tpptr: TimerPoolPtr)"><wbr />shrink<wbr />Timer<wbr />Pool<span class="attachedType">TimerPoolPtr</span></a></li>

  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#18" id="68">Templates</a>
  <ul class="simple simple-toc-section">
      <li><a class="reference" href="#checkForNil.t%2CTimerHandlePtr%2Cstring"
    title="checkForNil(timerhdl: TimerHandlePtr; callingProc: string = &quot;&quot;): void"><wbr />check<wbr />For<wbr />Nil<span class="attachedType">TimerHandlePtr</span></a></li>
  <li><a class="reference" href="#poolRef2Ptr.t%2CTimerPoolRef"
    title="poolRef2Ptr(stpp: TimerPoolRef): TimerPoolPtr"><wbr />pool<wbr />Ref2Ptr<span class="attachedType">TimerPoolRef</span></a></li>

  </ul>
</li>

</ul>

  </div>
  <div class="nine columns" id="content">
  <div id="tocRoot"></div>
  
  <p class="module-desc"><p>simple timerpool implementation for uncritical event-purposes. The &quot;tick&quot; is an abstract value and depends on the selected timebase and the environment</p>
<p>Its useful if you need wakeup-timers for protocol implementations or you like to calculate/interpolate something for a given timeslot</p>
<p>For each TimerPool object only one tickthread is spawned which handles the message-queue and the lifecycle of the TimerHandle. The maximum amount of timers is only constrained by memory and the given timebase.</p>
<p>The allocation of a new TimerHandle always block but is threadsafe. The maximum blocking-time relates directly to your given timebase of the pool</p>
<p>There is a blocking and a nonblocking API on the TimerHandles which can be used simulataneously from different threads at once. All actions on the TimerHandles are completely threadsafe and the ptrs itself can be shared between threads.</p>
<p>the following example demonstrates the basic use. For detailed api use and for multithreading examples use the tests as a starter.</p>
<pre class="listing"><span class="Keyword">import</span> <span class="Identifier">timerpool</span>

<span class="Keyword">let</span>
  <span class="Identifier">tpRef</span> <span class="Operator">=</span> <span class="Identifier">timerpool</span><span class="Operator">.</span><span class="Identifier">newTimerPool</span><span class="Punctuation">(</span><span class="FloatNumber">10.</span><span class="Identifier">int</span><span class="Punctuation">)</span> <span class="Comment"># timerpool with 10ms timebase</span>
  <span class="Identifier">timerhdl</span> <span class="Operator">=</span> <span class="Identifier">allocTimer</span><span class="Punctuation">(</span><span class="Identifier">tpRef</span><span class="Punctuation">)</span>

<span class="Identifier">timerhdl</span><span class="Operator">.</span><span class="Identifier">setAlarmCounter</span><span class="Punctuation">(</span><span class="DecNumber">5</span><span class="Punctuation">)</span>  <span class="Comment"># set expiration to 50ms (timebase * 5)</span>

<span class="Keyword">while</span> <span class="Identifier">timerhdl</span><span class="Operator">.</span><span class="Identifier">getAlarmCounter</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Operator">&gt;</span> <span class="DecNumber">0</span><span class="Punctuation">:</span> <span class="Comment"># you can poll it</span>
  <span class="Keyword">discard</span>

<span class="Identifier">timerhdl</span><span class="Operator">.</span><span class="Identifier">waitForAlarm</span><span class="Punctuation">(</span><span class="Punctuation">)</span>     <span class="Comment"># or sleep till timer expired</span>
<span class="Identifier">timerhdl</span><span class="Operator">.</span><span class="Identifier">deallocTimer</span><span class="Punctuation">(</span><span class="Punctuation">)</span>     <span class="Comment"># pushes the timer back to pool</span>
<span class="Identifier">tpRef</span><span class="Operator">.</span><span class="Identifier">shutdownTimerPool</span><span class="Punctuation">(</span><span class="Punctuation">)</span>   <span class="Comment"># shutdown the pool and blocks till all</span>
                            <span class="Comment"># timers are expired</span></pre></p>
  <div class="section" id="7">
<h1><a class="toc-backref" href="#7">Types</a></h1>
<dl class="item">
<a id="TimerHandlePtr"></a>
<dt><pre><a href="timerpool.html#TimerHandlePtr"><span class="Identifier">TimerHandlePtr</span></a> <span class="Other">=</span> <span class="Keyword">ptr</span> <span class="Identifier">TimerHandle</span></pre></dt>
<dd>

pointer type to the timerpoolhandle.

</dd>
<a id="TPError"></a>
<dt><pre><a href="timerpool.html#TPError"><span class="Identifier">TPError</span></a> <span class="Other">=</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">Exception</span>
  </pre></dt>
<dd>

generic exception

</dd>
<a id="TimerPoolPtr"></a>
<dt><pre><a href="timerpool.html#TimerPoolPtr"><span class="Identifier">TimerPoolPtr</span></a> <span class="Other">=</span> <span class="Keyword">ptr</span> <span class="Identifier">TimerPool</span></pre></dt>
<dd>

used to share among threads

</dd>
<a id="TimerPoolRef"></a>
<dt><pre><a href="timerpool.html#TimerPoolRef"><span class="Identifier">TimerPoolRef</span></a> <span class="Other">=</span> <span class="Keyword">ref</span> <span class="Identifier">TimerPool</span></pre></dt>
<dd>



</dd>
<a id="Tickval"></a>
<dt><pre><a href="timerpool.html#Tickval"><span class="Identifier">Tickval</span></a> <span class="Other">=</span> <span class="Identifier">range</span><span class="Other">[</span><span class="DecNumber">1</span> <span class="Operator">..</span> <span class="Identifier">int</span><span class="Other">.</span><span class="Identifier">high</span><span class="Other">]</span></pre></dt>
<dd>



</dd>
<a id="MinTimerval"></a>
<dt><pre><a href="timerpool.html#MinTimerval"><span class="Identifier">MinTimerval</span></a> <span class="Other">=</span> <span class="Identifier">range</span><span class="Other">[</span><span class="DecNumber">1</span> <span class="Operator">..</span> <span class="Identifier">int</span><span class="Other">.</span><span class="Identifier">high</span><span class="Other">]</span></pre></dt>
<dd>

integer type used to initialise the timerpool and to set the timeout of the timer

</dd>
<a id="PoolStats"></a>
<dt><pre><a href="timerpool.html#PoolStats"><span class="Identifier">PoolStats</span></a> <span class="Other">=</span> <span class="Keyword">tuple</span><span class="Other">[</span><span class="Identifier">runningCount</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">,</span> <span class="Identifier">freedCount</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">,</span> <span class="Identifier">inactiveCount</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">]</span></pre></dt>
<dd>

container type returned by waitForGetStats. the sum of runningCount,freedCount and inactiveCount is the total amount of timerhandles within the pool

</dd>

</dl></div>
<div class="section" id="12">
<h1><a class="toc-backref" href="#12">Procs</a></h1>
<dl class="item">
<a id="initThreadContext,TimerPoolPtr"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#initThreadContext%2CTimerPoolPtr"><span class="Identifier">initThreadContext</span></a><span class="Other">(</span><span class="Identifier">tpptr</span><span class="Other">:</span> <a href="timerpool.html#TimerPoolPtr"><span class="Identifier">TimerPoolPtr</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">void</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><a href="timerpool.html#TPError"><span class="Identifier">TPError</span></a><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>to be called explicit if the pool-accessing thread is not the owner of the timerpool (initialises threadvar globs)</p>
<p>raises a TPError if called within the spawning thread</p>


</dd>
<a id="newTimerPool,Tickval,MinTimerval"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#newTimerPool%2CTickval%2CMinTimerval"><span class="Identifier">newTimerPool</span></a><span class="Other">(</span><span class="Identifier">tbase_ms</span><span class="Other">:</span> <a href="timerpool.html#Tickval"><span class="Identifier">Tickval</span></a> <span class="Other">=</span> <span class="DecNumber">100</span><span class="Other">;</span> <span class="Identifier">minFreedTimers</span><span class="Other">:</span> <a href="timerpool.html#MinTimerval"><span class="Identifier">MinTimerval</span></a> <span class="Other">=</span> <span class="DecNumber">5</span><span class="Other">)</span><span class="Other">:</span> <span class="Keyword">ref</span> <span class="Identifier">TimerPool</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma">
    <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

creator proc. The tickval is of milliseconds and the default timebase is 100 milliseconds the default of the mintimers parameter is 5 (shrink_pool leave this minimum amount of freed timers within the pool)

</dd>
<a id="deinitThreadContext,TimerPoolPtr"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#deinitThreadContext%2CTimerPoolPtr"><span class="Identifier">deinitThreadContext</span></a><span class="Other">(</span><span class="Identifier">tpptr</span><span class="Other">:</span> <a href="timerpool.html#TimerPoolPtr"><span class="Identifier">TimerPoolPtr</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">void</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><a href="timerpool.html#TPError"><span class="Identifier">TPError</span></a><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>call this proc if the pool-accessing thread should be detached from the timerpool (cleanup threadvar globs)</p>
<p>call this proc only if the current thread is not owner of the timerpool. if not a TPError is raised</p>


</dd>
<a id="allocTimer,TimerPoolPtr"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#allocTimer%2CTimerPoolPtr"><span class="Identifier">allocTimer</span></a><span class="Other">(</span><span class="Identifier">tpptr</span><span class="Other">:</span> <a href="timerpool.html#TimerPoolPtr"><span class="Identifier">TimerPoolPtr</span></a><span class="Other">)</span><span class="Other">:</span> <a href="timerpool.html#TimerHandlePtr"><span class="Identifier">TimerHandlePtr</span></a> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><a href="timerpool.html#TPError"><span class="Identifier">TPError</span></a><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>returns a timerhandle. the timer is always of type:oneshot but could also act as a continous one. in this case the caller needs to reset the alarm to the needed value. This threadsafe call blocks till the request was handled by the pool-tick-thread</p>
<p>before calling (if the pool was not spawned by the calling thread) initThreadContext() should be called</p>
<p>raises TPError if the pointer parameter is nil and/or the threadContext was not initialised with initThreadContext</p>


</dd>
<a id="allocTimer,TimerPoolRef"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#allocTimer%2CTimerPoolRef"><span class="Identifier">allocTimer</span></a><span class="Other">(</span><span class="Identifier">tpptr</span><span class="Other">:</span> <a href="timerpool.html#TimerPoolRef"><span class="Identifier">TimerPoolRef</span></a><span class="Other">)</span><span class="Other">:</span> <a href="timerpool.html#TimerHandlePtr"><span class="Identifier">TimerHandlePtr</span></a> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">inline</span><span class="Other">,</span> <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><a href="timerpool.html#TPError"><span class="Identifier">TPError</span></a><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>



</dd>
<a id="deallocTimer,TimerHandlePtr"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#deallocTimer%2CTimerHandlePtr"><span class="Identifier">deallocTimer</span></a><span class="Other">(</span><span class="Identifier">timerhdl</span><span class="Other">:</span> <a href="timerpool.html#TimerHandlePtr"><span class="Identifier">TimerHandlePtr</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">void</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><a href="timerpool.html#TPError"><span class="Identifier">TPError</span></a><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>the timer handle is pushed back to the pool. once freed it is not handled by the timerscan any more and its recycled for later use</p>
<p>this proc could be called from multiple threads simultaneously. if one ore more threads are waiting on the timers signal all threads gets informed. This call is part of the nonblocking api</p>
<p>raises TPError if the pointer parameter is nil</p>


</dd>
<a id="setAlarmCounter,TimerHandlePtr,Tickval"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#setAlarmCounter%2CTimerHandlePtr%2CTickval"><span class="Identifier">setAlarmCounter</span></a><span class="Other">(</span><span class="Identifier">timerhdl</span><span class="Other">:</span> <a href="timerpool.html#TimerHandlePtr"><span class="Identifier">TimerHandlePtr</span></a><span class="Other">;</span> <span class="Identifier">value</span><span class="Other">:</span> <a href="timerpool.html#Tickval"><span class="Identifier">Tickval</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">void</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma">
    <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><a href="timerpool.html#TPError"><span class="Identifier">TPError</span></a><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>sets the timers countdown alarm-value to the given one. reset the counter after itÂ´s fired to obtain a continous timer</p>
<p>this call is threadsafe and part of the nonblocking-api</p>
<p>raises TPError if the pointer parameter is nil or the timer is freed</p>


</dd>
<a id="getAlarmCounter,TimerHandlePtr"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#getAlarmCounter%2CTimerHandlePtr"><span class="Identifier">getAlarmCounter</span></a><span class="Other">(</span><span class="Identifier">timerhdl</span><span class="Other">:</span> <a href="timerpool.html#TimerHandlePtr"><span class="Identifier">TimerHandlePtr</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">int</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><a href="timerpool.html#TPError"><span class="Identifier">TPError</span></a><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>returns the current value of the alarmcounter could be used for a polling-style-waiting_for_timer_fired</p>
<p>this call is threadsafe and part of the nonblocking-api</p>
<p>raises TPError if the pointer parameter is nil or the timer already freed</p>


</dd>
<a id="waitForAlarm,TimerHandlePtr"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#waitForAlarm%2CTimerHandlePtr"><span class="Identifier">waitForAlarm</span></a><span class="Other">(</span><span class="Identifier">timerhdl</span><span class="Other">:</span> <a href="timerpool.html#TimerHandlePtr"><span class="Identifier">TimerHandlePtr</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">void</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><a href="timerpool.html#TPError"><span class="Identifier">TPError</span></a><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>blocking wait till the alarmcounter is decremented to 0</p>
<p>threadsafe impl and could be called by multiple threads simultaniously</p>
<p>raises TPError if the pointer parameter is nil or the timer already freed</p>


</dd>
<a id="waitForGetStats,TimerPoolPtr"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#waitForGetStats%2CTimerPoolPtr"><span class="Identifier">waitForGetStats</span></a><span class="Other">(</span><span class="Identifier">tpptr</span><span class="Other">:</span> <a href="timerpool.html#TimerPoolPtr"><span class="Identifier">TimerPoolPtr</span></a><span class="Other">)</span><span class="Other">:</span> <a href="timerpool.html#PoolStats"><span class="Identifier">PoolStats</span></a> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><a href="timerpool.html#TPError"><span class="Identifier">TPError</span></a><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>fetches some pool statistics for debugging purposes</p>
<p>raises TPError if the pointer parameter is nil or the threadContext was not initialized with initThreadContext</p>


</dd>
<a id="shrinkTimerPool,TimerPoolPtr"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#shrinkTimerPool%2CTimerPoolPtr"><span class="Identifier">shrinkTimerPool</span></a><span class="Other">(</span><span class="Identifier">tpptr</span><span class="Other">:</span> <a href="timerpool.html#TimerPoolPtr"><span class="Identifier">TimerPoolPtr</span></a><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><a href="timerpool.html#TPError"><span class="Identifier">TPError</span></a><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>shrinks the pool of freed Timers. the given minFreedTimers value at pool construction specifies the lower watermark</p>
<p>this is a nonblocking call. raises TPError if the pointer parameter is nil and/or the threadContext was not initialised with initThreadContext (only needed if the pool was not spawned by the caller)</p>


</dd>

</dl></div>
<div class="section" id="18">
<h1><a class="toc-backref" href="#18">Templates</a></h1>
<dl class="item">
<a id="checkForNil.t,TimerHandlePtr,string"></a>
<dt><pre><span class="Keyword">template</span> <a href="#checkForNil.t%2CTimerHandlePtr%2Cstring"><span class="Identifier">checkForNil</span></a><span class="Other">(</span><span class="Identifier">timerhdl</span><span class="Other">:</span> <a href="timerpool.html#TimerHandlePtr"><span class="Identifier">TimerHandlePtr</span></a><span class="Other">;</span> <span class="Identifier">callingProc</span><span class="Other">:</span> <span class="Identifier">string</span> <span class="Other">=</span> <span class="StringLit">&quot;&quot;</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">void</span></pre></dt>
<dd>

checks if the timerhdl is nil. if so a TPError is raised

</dd>
<a id="poolRef2Ptr.t,TimerPoolRef"></a>
<dt><pre><span class="Keyword">template</span> <a href="#poolRef2Ptr.t%2CTimerPoolRef"><span class="Identifier">poolRef2Ptr</span></a><span class="Other">(</span><span class="Identifier">stpp</span><span class="Other">:</span> <a href="timerpool.html#TimerPoolRef"><span class="Identifier">TimerPoolRef</span></a><span class="Other">)</span><span class="Other">:</span> <a href="timerpool.html#TimerPoolPtr"><span class="Identifier">TimerPoolPtr</span></a></pre></dt>
<dd>

convenience template to get the TimerPoolPtr from the ref

</dd>

</dl></div>

  </div>
</div>

    <div class="row">
      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br/>
        <small style="color: var(--hint);">Made with Nim. Generated: 2020-05-09 14:48:50 UTC</small>
      </div>
    </div>
  </div>
</div>

</body>
</html>
